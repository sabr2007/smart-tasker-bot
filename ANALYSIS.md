# Анализ проекта "AI Smart-Tasker"

## Обзор проекта
Проект представляет собой **умный таск-менеджер** с гибридным интерфейсом:
1.  **Telegram-бот**: позволяет управлять задачами через чат с помощью естественного языка (текст и голосовые сообщения).
2.  **Telegram Web App (Mini App)**: полноценный веб-интерфейс (SPA на Vue 3) для визуального управления задачами и календарем.

Основная "фишка" проекта — использование LLM (GPT-4o) для парсинга намерений пользователя, что позволяет понимать сложные команды вроде "напомни позвонить маме завтра в 5 вечера" или "перенеси все задачи на понедельник".

---

## Технический стек

### Backend
*   **Язык**: Python 3.11
*   **Фреймворк Web**: FastAPI (для обслуживания API Web App и статики).
*   **Telegram Bot**: `python-telegram-bot` (версия 20.8).
*   **AI/LLM**: OpenAI API (`gpt-4o` для логики, `whisper` для транскрибации голоса).
*   **База данных**: SQLite (асинхронная библиотека `aiosqlite`).
*   **Инфраструктура**: `uvicorn` (ASGI сервер), простой скрипт запуска `start.sh`.

### Frontend (Web App)
*   **Фреймворк**: Vue 3 (используется CDN-сборка, без сложного build-процесса).
*   **UI Компоненты**: Кастомные стили (`style.css`), иконки Lucide.
*   **Взаимодействие с Telegram**: `Telegram WebApp SDK`.

---

## Архитектура и качество кода

### Структура
Проект имеет четкую модульную структуру:
*   `src/bot/`: логика бота (хендлеры, клавиатуры, сервисы).
*   `src/web/`: API бэкенд для Web App.
*   `src/webapp/`: статические файлы фронтенда.
*   `src/llm_client.py`: слой абстракции для работы с AI (хорошо изолирован).
*   `src/db.py`: слой работы с БД.

### Качество кода
*   **Плюсы**:
    *   Использование асинхронности (`asyncio`, `aiosqlite`) везде, что критично для производительности бота.
    *   Хорошая типизация (Type Hints).
    *   Разделение ответственности (хендлеры отделены от бизнес-логики и работы с БД).
    *   Присутствует механизм миграций БД (в `init_db`).
    *   Внедрена защита API через валидацию `initData` от Telegram (`src/web/auth.py`), что обеспечивает безопасность Web App.
*   **Минусы**:
    *   Отсутствие тестов (папка `tests/` не обнаружена или пуста).
    *   Смешивание бизнес-логики и SQL-запросов внутри `db.py` (хотя для небольшого проекта это допустимо).

---

## Ключевые возможности и преимущества

1.  **Продвинутый AI-парсинг**:
    *   Поддержка **мульти-интентов** (несколько команд в одном сообщении).
    *   **Контекстуальность**: Бот знает текущие задачи и может понять "удали её", ссылаясь на контекст.
    *   Валидация действий ("защита от дурака" при удалении).
    *   Обработка относительных дат и времени.

2.  **Голосовое управление**:
    *   Бесшовная интеграция Whisper для транскрибации голосовых сообщений в текст, который затем обрабатывается как обычная команда.

3.  **Гибридный UX**:
    *   Быстрое добавление задач через чат (на ходу).
    *   Удобное планирование и обзор через Web App (календарь, списки).

4.  **Функциональность**:
    *   Напоминания и ежедневные дайджесты (Job Queue).
    *   Архив выполненных задач.
    *   Возможность настройки часового пояса (хотя есть нюансы, см. ниже).

---

## Проблемы и риски

### 1. База данных (SQLite)
Использование SQLite (`tasks.db`) — главное слабое место для продакшн-развертывания в облачных контейнерах (Heroku, Render, Dokku).
*   **Проблема**: Файловая система в таких средах обычно эфемерна. При перезапуске контейнера (деплой, падение) файл базы данных **будет стерт**, и все данные пользователей пропадут.
*   **Решение**: Необходимо подключить внешнюю базу данных (PostgreSQL) или настроить persistent volume (если хостинг позволяет).

### 2. Конкурентность и запуск (`start.sh`)
Скрипт запуска запускает `uvicorn` в фоне (`&`) и бота в основном процессе.
*   **Риск**: Если процесс веб-сервера упадет, бот продолжит работать (и наоборот), но Web App станет недоступным. Нет единого менеджера процессов (как supervisord).

### 3. Часовые пояса
В `src/config.py` жестко задан `FIXED_TZ_OFFSET = "+05:00"`.
*   **Конфликт**: В коде есть логика для поддержки разных часовых поясов пользователей (таблица `users`, настройки в Web App), но этот хардкод может принудительно переопределять или ломать логику для пользователей из других регионов.

### 4. Frontend-зависимости
Frontend использует Vue 3 и Lucide через CDN (`unpkg.com`).
*   **Риск**: Если CDN будет недоступен или работает медленно, Web App не загрузится. Для продакшена лучше собирать ассеты локально (Webpack/Vite) или вендорить библиотеки.

### 5. Отсутствие документации
Файл `README.md` пуст. Новому разработчику будет сложно понять, как запустить проект локально, какие переменные окружения нужны и как работает архитектура.

---

## Рекомендации

1.  **Переход на PostgreSQL**: Заменить `aiosqlite` на `asyncpg` или использовать ORM (SQLAlchemy/Tortoise) с поддержкой Postgres для надежного хранения данных.
2.  **Docker & Docker-Compose**: Описать полноценный `Dockerfile` и `docker-compose.yml` для удобного развертывания и локальной разработки (Бот + БД).
3.  **Улучшение запуска**: Использовать `supervisord` или разнести веб-сервер и бота по разным контейнерам.
4.  **Тестирование**: Добавить unit-тесты, особенно для логики парсинга команд (`llm_client.py`), так как это критически важная часть, зависящая от вероятностной модели.
5.  **Исправление Timezone**: Убрать хардкод `FIXED_TZ_OFFSET` и полноценно полагаться на настройку пользователя из БД.
6.  **Сборка Frontend**: Перевести фронтенд на сборку (Vite), чтобы не зависеть от CDN и улучшить производительность.
