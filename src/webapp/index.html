<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no" />
  <title>Smart-Tasker</title>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Vue 3 (Local Build) -->
  <script src="/vendor/vue.global.prod.js"></script>

  <!-- Inline SVG Icons (replaces Lucide CDN) -->
  <script>
    // Inline SVG icon system - replaces Lucide CDN (~200KB ‚Üí ~3KB)
    const ICONS = {
      'check': '<polyline points="20 6 9 17 4 12"/>',
      'clock': '<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>',
      'calendar': '<rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>',
      'settings': '<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>',
      'chevron-left': '<polyline points="15 18 9 12 15 6"/>',
      'chevron-right': '<polyline points="9 18 15 12 9 6"/>',
      'chevron-up': '<polyline points="18 15 12 9 6 15"/>',
      'chevron-down': '<polyline points="6 9 12 15 18 9"/>',
      'external-link': '<path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/>',
      'link': '<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>',
      'phone': '<path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>',
      'paperclip': '<path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>',
      'repeat': '<polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>',
      'archive': '<polyline points="21 8 21 21 3 21 3 8"/><rect x="1" y="3" width="22" height="5"/><line x1="10" y1="12" x2="14" y2="12"/>',
      'trash-2': '<polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>',
      'x': '<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>',
      'edit-3': '<path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>',
      'list-todo': '<rect x="3" y="5" width="6" height="6" rx="1"/><path d="m3 17 2 2 4-4"/><line x1="13" y1="6" x2="21" y2="6"/><line x1="13" y1="12" x2="21" y2="12"/><line x1="13" y1="18" x2="21" y2="18"/>',
      'book-open': '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>',
      'globe': '<circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>',
      'arrow-left': '<line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/>'
    };

    // Replace lucide.createIcons() with lightweight inline SVG renderer
    window.lucide = {
      createIcons: function () {
        document.querySelectorAll('[data-lucide]').forEach(el => {
          const name = el.getAttribute('data-lucide');
          const icon = ICONS[name];
          if (icon && !el.querySelector('svg')) {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('viewBox', '0 0 24 24');
            svg.setAttribute('fill', 'none');
            svg.setAttribute('stroke', 'currentColor');
            svg.setAttribute('stroke-width', '2');
            svg.setAttribute('stroke-linecap', 'round');
            svg.setAttribute('stroke-linejoin', 'round');
            svg.innerHTML = icon;
            el.innerHTML = '';
            el.appendChild(svg);
          }
        });
      }
    };
  </script>

  <link rel="stylesheet" href="/style.css" />
</head>

<body>
  <div id="app" v-cloak>
    <!-- Screen: Main App -->
    <div class="app" v-if="!loading">

      <!-- Header: Tasks Tab (with greeting & progress) -->
      <header class="header header-tasks" v-if="activeTab === 'tasks'">
        <div class="header-left">
          <div class="greeting">{{ greeting }}</div>
          <div class="tasks-summary" v-if="todayStats.total > 0">
            {{ todayStats.percent === 100 ? '–í—Å—ë —Å–¥–µ–ª–∞–Ω–æ! üéâ' : `–°–µ–≥–æ–¥–Ω—è ${todayStats.completed} –∏–∑ ${todayStats.total}
            –∑–∞–¥–∞—á` }}
          </div>
        </div>
        <button class="icon-btn" @click="openSettings">
          <i data-lucide="settings"></i>
        </button>
      </header>

      <!-- Progress Bar (only on tasks tab with tasks) -->
      <div class="progress-bar-container" v-if="activeTab === 'tasks' && todayStats.total > 0">
        <div class="progress-bar">
          <div class="progress-fill" :class="{ complete: todayStats.percent === 100 }"
            :style="{ width: todayStats.percent + '%' }"></div>
        </div>
        <div class="progress-percent" :style="{ color: todayStats.percent === 100 ? '#4CAF50' : '' }">{{
          todayStats.percent }}%</div>
      </div>

      <!-- Header: Calendar Tab -->
      <header class="header" v-else>
        <div class="header-title">{{ headerTitle }}</div>
        <button class="icon-btn" @click="openSettings">
          <i data-lucide="settings"></i>
        </button>
      </header>

      <!-- Content -->
      <main class="content">

        <!-- Tab: Tasks -->
        <div v-show="activeTab === 'tasks'">
          <div v-if="tasks.length === 0" class="status-msg">
            –ó–∞–¥–∞—á –Ω–µ—Ç. –û—Ç–¥—ã—Ö–∞–π! üèù
          </div>

          <div v-else>
            <div v-for="group in taskGroups" :key="group.title" class="task-group">
              <div class="group-title">{{ group.title }}</div>
              <div v-for="task in group.items" :key="task.id" class="task-item" @click="openSheet(task)">
                <div class="task-checkbox" :class="{ done: !!task.completed_at }" @click.stop="toggleTask(task)">
                  <i data-lucide="check"></i>
                </div>
                <div class="task-content">
                  <div class="task-text" :class="{ 'text-done': !!task.completed_at }">
                    {{ task.text }}
                    <i v-if="task.has_attachment" data-lucide="paperclip"
                      style="width: 14px; height: 14px; vertical-align: middle; margin-left: 4px; opacity: 0.6;"></i>
                    <i v-if="task.is_recurring" data-lucide="repeat"
                      style="width: 14px; height: 14px; vertical-align: middle; margin-left: 4px; opacity: 0.6;"></i>
                  </div>
                  <div class="task-meta" :class="{ overdue: isOverdue(task) }">
                    <i data-lucide="clock" style="width:12px; height:12px;" v-if="task.due_at"></i>
                    {{ formatDue(task.due_at) }}
                  </div>
                </div>
                <!-- Phone Action -->
                <button v-if="task.phone" class="icon-btn" style="color: #34c759; padding: 4px;"
                  @click.stop="openPhone(task.phone)">
                  <i data-lucide="phone" style="width: 18px; height: 18px;"></i>
                </button>
                <!-- Link Action -->
                <button v-if="task.link_url" class="icon-btn" style="color: #3390ec; padding: 4px;"
                  @click.stop="openLink(task.link_url)">
                  <i data-lucide="external-link" style="width: 18px; height: 18px;"></i>
                </button>
                <!-- Archive Action -->
                <button v-if="task.completed_at" class="icon-btn"
                  style="color: var(--tg-theme-hint-color); padding: 4px;" @click.stop="archiveTask(task)">
                  <i data-lucide="archive" style="width: 18px; height: 18px;"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Calendar -->
        <div v-show="activeTab === 'calendar'" class="calendar-view">
          <div class="mini-calendar" style="margin-bottom: 20px;">
            <div class="mc-header">
              <button class="icon-btn small" @click="calPrevMonth"><i data-lucide="chevron-left"></i></button>
              <div class="calendar-title">{{ calendarTitle }}</div>
              <button class="icon-btn small" @click="calNextMonth"><i data-lucide="chevron-right"></i></button>
            </div>
            <div class="mc-grid">
              <div class="mc-day muted" v-for="d in ['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å']">{{d}}</div>
              <div v-for="day in calendarDays" :key="day.date" class="mc-day" :class="{ 
                  empty: !day.day,
                  today: day.isToday,
                  selected: day.date === selectedDate
                }" @click="day.day && selectDate(day.date)">
                {{ day.day }}
                <div class="cal-dots" v-if="day.hasTasks">
                  <div class="cal-dot"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="group-title">–ó–∞–¥–∞—á–∏ –Ω–∞ {{ formatDate(selectedDate) }}</div>
          <div v-if="calendarTasks.length === 0" class="status-msg" style="padding: 20px 0;">
            –ù–µ—Ç –∑–∞–¥–∞—á
          </div>
          <div v-for="task in calendarTasks" :key="task.id" class="task-item" @click="openSheet(task)">
            <div class="task-checkbox" @click.stop="toggleTask(task)">
              <i data-lucide="check"></i>
            </div>
            <div class="task-content">
              <div class="task-text">
                {{ task.text }}
                <i v-if="task.is_recurring" data-lucide="repeat"
                  style="width: 14px; height: 14px; vertical-align: middle; margin-left: 4px; opacity: 0.6;"></i>
              </div>
              <div class="task-meta">{{ formatTime(task.due_at) }}</div>
            </div>
          </div>
        </div>

      </main>

      <!-- Tabbar (—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ–≤–µ—Ä–ª–µ—è—Ö) -->
      <div class="tabbar" v-show="!settingsOpen && !archiveOpen">
        <button class="tab-btn" :class="{ active: activeTab === 'tasks' }" @click="activeTab = 'tasks'">
          <i data-lucide="list-todo"></i>
          <span>–ó–∞–¥–∞—á–∏</span>
        </button>
        <button class="tab-btn" :class="{ active: activeTab === 'calendar' }" @click="activeTab = 'calendar'">
          <i data-lucide="calendar"></i>
          <span>–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
        </button>
      </div>

    </div>

    <!-- Loader -->
    <div class="app-loader" v-else>
      <div class="spinner"></div>
    </div>


    <!-- Bottom Sheet -->
    <div class="sheet-backdrop" :class="{ open: sheet.open }" @click="closeSheet"></div>

    <div class="sheet" :class="{ open: sheet.open }">
      <div class="sheet-handle"></div>

      <!-- Mode: Menu -->
      <div v-if="sheet.mode === 'menu'">
        <div class="sheet-title">{{ sheet.task?.text }}</div>
        <div class="action-list">
          <button class="action-btn" @click="sheet.mode = 'edit'">
            <i data-lucide="edit-3"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
          </button>
          <button class="action-btn" @click="initReschedule">
            <i data-lucide="clock"></i>
            {{ sheet.task?.due_at ? '–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–µ–¥–ª–∞–π–Ω' : '–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω' }}
          </button>
          <button class="action-btn danger" @click="sheet.mode = 'delete'">
            <i data-lucide="trash-2"></i> –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É
          </button>
        </div>
      </div>

      <!-- Mode: Edit Text -->
      <div v-if="sheet.mode === 'edit'">
        <div class="sheet-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
        <div class="form-group">
          <textarea class="input-field" rows="3" v-model="editForm.text" ref="focusInput"></textarea>
          <button class="primary-btn" @click="saveText" :disabled="!editForm.text.trim()">
            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
          </button>
        </div>
      </div>

      <!-- Mode: Reschedule -->
      <div v-if="sheet.mode === 'reschedule'">
        <div class="sheet-title">–î–µ–¥–ª–∞–π–Ω</div>

        <div class="quick-dates">
          <button class="chip" @click="setDeadline('today')">–°–µ–≥–æ–¥–Ω—è</button>
          <button class="chip" @click="setDeadline('tomorrow')">–ó–∞–≤—Ç—Ä–∞</button>
          <button class="chip" @click="setDeadline('next_week')">–°–ª–µ–¥. –Ω–µ–¥–µ–ª—è</button>
          <button class="chip" @click="setDeadline(null)" style="color: var(--tg-theme-destructive-text-color)">
            –£–±—Ä–∞—Ç—å
          </button>
        </div>

        <div class="mini-calendar">
          <!-- Simple date picker logic reusing calendar state or separate? 
                For simplicity reusing separate simplified picker or same logic.
                Let's use a simplified list of days for now or relying on chips + HTML date input as fallback for specific dates -->
          <input type="datetime-local" class="input-field" v-model="editForm.date" style="text-align: center;" />
        </div>
        <button class="primary-btn" @click="saveDeadline">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>

      <!-- Mode: Delete Confirm -->
      <div v-if="sheet.mode === 'delete'">
        <div class="sheet-title">–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?</div>
        <div class="status-msg" style="padding: 10px 0 20px;">
          –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.
        </div>
        <div class="action-list">
          <button class="action-btn danger" @click="deleteTask">
            <i data-lucide="trash-2"></i> –î–∞, —É–¥–∞–ª–∏—Ç—å
          </button>
          <button class="action-btn" @click="sheet.mode = 'menu'">
            –û—Ç–º–µ–Ω–∞
          </button>
        </div>
      </div>

    </div>

    <!-- Settings Overlay -->
    <div class="overlay" v-if="settingsOpen" style="z-index: 60;">
      <div class="overlay-header">
        <button class="icon-btn" @click="settingsOpen = false"><i data-lucide="x"></i></button>
        <div class="overlay-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
        <div style="width: 40px"></div>
      </div>
      <div class="overlay-content">
        <div class="settings-cards">
          <!-- Timezone -->
          <div class="settings-card" @click="openTimezone">
            <div class="settings-card-icon"><i data-lucide="globe"></i></div>
            <div class="settings-card-content">
              <div class="settings-card-title">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</div>
              <div class="settings-card-sub">{{ currentTimezoneLabel }}</div>
            </div>
            <div class="settings-card-arrow"><i data-lucide="chevron-right"></i></div>
          </div>

          <!-- Archive -->
          <div class="settings-card" @click="openArchive">
            <div class="settings-card-icon"><i data-lucide="archive"></i></div>
            <div class="settings-card-content">
              <div class="settings-card-title">–ê—Ä—Ö–∏–≤</div>
              <div class="settings-card-sub">{{ archiveCount }} –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö</div>
            </div>
            <div class="settings-card-arrow"><i data-lucide="chevron-right"></i></div>
          </div>

          <!-- Help -->
          <div class="settings-card" @click="openHelp">
            <div class="settings-card-icon"><i data-lucide="book-open"></i></div>
            <div class="settings-card-content">
              <div class="settings-card-title">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</div>
            </div>
            <div class="settings-card-arrow"><i data-lucide="chevron-right"></i></div>
          </div>
        </div>

        <!-- Footer -->
        <div class="settings-footer">
          <div class="settings-version">Smart Tasker v2.2</div>
          <div class="settings-credits">Made with ‚ù§Ô∏è in Kazakhstan</div>
        </div>
      </div>
    </div>

    <!-- Timezone Overlay -->
    <div class="overlay" v-if="timezoneOpen" style="z-index: 62;">
      <div class="overlay-header">
        <button class="icon-btn" @click="timezoneOpen = false; timezoneSearch = ''"><i
            data-lucide="arrow-left"></i></button>
        <div class="overlay-title">–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</div>
        <div style="width: 40px"></div>
      </div>
      <div class="overlay-content">
        <!-- Search -->
        <div class="tz-search">
          <input type="text" v-model="timezoneSearch" class="input-field" placeholder="–ü–æ–∏—Å–∫..." />
        </div>

        <!-- Popular (only shown when not searching) -->
        <div v-if="!timezoneSearch.trim()" class="tz-section">
          <div class="tz-section-title">–ü–û–ü–£–õ–Ø–†–ù–´–ï</div>
          <div class="tz-list">
            <div v-for="tz in POPULAR_TIMEZONES" :key="tz.value" class="tz-item"
              :class="{ selected: tz.value === userTimezone }" @click="selectTimezone(tz.value)">
              <div class="tz-label">{{ tz.label }}</div>
              <div class="tz-check" v-if="tz.value === userTimezone"><i data-lucide="check"></i></div>
            </div>
          </div>
        </div>

        <!-- All / Filtered -->
        <div class="tz-section">
          <div class="tz-section-title">{{ timezoneSearch.trim() ? '–†–ï–ó–£–õ–¨–¢–ê–¢–´' : '–í–°–ï' }}</div>
          <div class="tz-list">
            <div v-for="tz in filteredTimezones" :key="tz.value" class="tz-item"
              :class="{ selected: tz.value === userTimezone }" @click="selectTimezone(tz.value)">
              <div class="tz-label">{{ tz.label }}</div>
              <div class="tz-check" v-if="tz.value === userTimezone"><i data-lucide="check"></i></div>
            </div>
            <div v-if="filteredTimezones.length === 0" class="status-msg">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Help Overlay -->
    <div class="overlay" v-if="helpOpen" style="z-index: 62;">
      <div class="overlay-header">
        <button class="icon-btn" @click="helpOpen = false"><i data-lucide="arrow-left"></i></button>
        <div class="overlay-title">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</div>
        <div style="width: 40px"></div>
      </div>
      <div class="overlay-content">
        <div class="help-cards">
          <div class="help-card">
            <div class="help-card-emoji">üí¨</div>
            <div class="help-card-title">–ü–∏—à–∏ –∫–∞–∫ –¥—É–º–∞–µ—à—å</div>
            <div class="help-card-text">"–ù–∞–ø–æ–º–Ω–∏ –∫—É–ø–∏—Ç—å —Ö–ª–µ–± –∑–∞–≤—Ç—Ä–∞ –≤ 18:00"</div>
          </div>

          <div class="help-card">
            <div class="help-card-emoji">üé§</div>
            <div class="help-card-title">–ì–æ–ª–æ—Å–æ–≤—ã–µ</div>
            <div class="help-card-text">–î–∏–∫—Ç—É–π —Å–ø–∏—Å–æ–∫ –¥–µ–ª ‚Äî —è —Å–∞–º —Ä–∞–∑–±–µ—Ä—É</div>
          </div>

          <div class="help-card">
            <div class="help-card-emoji">üì∏</div>
            <div class="help-card-title">–§–æ—Ç–æ –∏ PDF</div>
            <div class="help-card-text">–°–∫–∏–Ω—å —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ –±–∏–ª–µ—Ç ‚Äî –≤—ã—Ç–∞—â—É –¥–∞—Ç—ã</div>
          </div>

          <div class="help-card">
            <div class="help-card-emoji">‚úèÔ∏è</div>
            <div class="help-card-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</div>
            <div class="help-card-text">–ñ–º–∏ –Ω–∞ –∑–∞–¥–∞—á—É —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Archive Overlay -->
    <div class="overlay" v-if="archiveOpen" style="z-index: 61;">
      <div class="overlay-header">
        <button class="icon-btn" @click="archiveOpen = false"><i data-lucide="arrow-left"></i></button>
        <div class="overlay-title">–ê—Ä—Ö–∏–≤</div>
        <button class="icon-btn danger" @click="clearArchive" v-if="archiveTasks.length > 0">
          <i data-lucide="trash-2"></i>
        </button>
        <div style="width: 40px" v-else></div>
      </div>
      <div class="overlay-content">
        <div v-if="loadingArchive" class="status-msg">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div v-else-if="archiveTasks.length === 0" class="status-msg">–ê—Ä—Ö–∏–≤ –ø—É—Å—Ç</div>
        <div v-else>
          <!-- Day Groups: –°–µ–≥–æ–¥–Ω—è / –í—á–µ—Ä–∞ / –†–∞–Ω–µ–µ -->
          <div v-for="group in archiveGroups" :key="group.title" class="archive-group">
            <div class="archive-group-title">{{ group.title }}</div>
            <div v-for="task in group.items" :key="task.id" class="archive-task">
              <div class="archive-task-checkbox">
                <i data-lucide="check"></i>
              </div>
              <div class="archive-task-content">
                <div class="archive-task-text">{{ task.text }}</div>
                <div class="archive-task-time">{{ formatCompletedTime(task.completed_at, group.title) }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="/main.js"></script>
</body>

</html>